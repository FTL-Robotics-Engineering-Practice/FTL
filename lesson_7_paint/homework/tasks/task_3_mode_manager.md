# üîÑ –ë–ª–æ–∫ 3: –†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã - ModeManager

## üéØ –¶–µ–ª—å

–°–µ–π—á–∞—Å —É –Ω–∞—Å –µ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º–∞: —Ä–µ–¥–∞–∫—Ç–æ—Ä –∫–∞—Ä—Ç—ã –∏ —Ä–æ–±–æ—Ç —Ä–∞–±–æ—Ç–∞—é—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ. –ï—Å–ª–∏ –º—ã —Ö–æ—Ç–∏–º —É–ø—Ä–∞–≤–ª—è—Ç—å —Ä–æ–±–æ—Ç–æ–º, –º—ã—à—å –≤—Å—ë —Ä–∞–≤–Ω–æ —Ä–∏—Å—É–µ—Ç –Ω–∞ –∫–∞—Ä—Ç–µ!

**–†–µ—à–µ–Ω–∏–µ:** –†–∞–∑–¥–µ–ª–∏—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É –Ω–∞ **–¥–≤–∞ —Ä–µ–∂–∏–º–∞**:
1. **MAP_EDIT** ‚Äî —Ä–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–∞—Ä—Ç—ã (–º—ã—à—å —Ä–∏—Å—É–µ—Ç, —Ä–æ–±–æ—Ç —Å—Ç–æ–∏—Ç)
2. **ROBOT** ‚Äî —Ä–µ–∂–∏–º —Ä–æ–±–æ—Ç–∞ (WASD —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ, –º—ã—à—å –Ω–µ —Ä–∏—Å—É–µ—Ç)

–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É —Ä–µ–∂–∏–º–∞–º–∏ ‚Äî –∫–ª–∞–≤–∏—à–∞ **TAB**.

---

## üß† –¢–µ–æ—Ä–∏—è: –ü–∞—Ç—Ç–µ—Ä–Ω State Machine

**State Machine (–ú–∞—à–∏–Ω–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π)** ‚Äî —ç—Ç–æ –ø–∞—Ç—Ç–µ—Ä–Ω, –≥–¥–µ –ø—Ä–æ–≥—Ä–∞–º–º–∞ –º–æ–∂–µ—Ç –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ —Ä–∞–∑–Ω—ã—Ö **—Å–æ—Å—Ç–æ—è–Ω–∏—è—Ö**, –∏ –≤ –∫–∞–∂–¥–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –≤–µ–¥—ë—Ç —Å–µ–±—è –ø–æ-—Ä–∞–∑–Ω–æ–º—É.

### –ü—Ä–∏–º–µ—Ä –∏–∑ –∂–∏–∑–Ω–∏: –°–≤–µ—Ç–æ—Ñ–æ—Ä

```
–°–æ—Å—Ç–æ—è–Ω–∏—è: –ö–†–ê–°–ù–´–ô, –ñ–Å–õ–¢–´–ô, –ó–ï–õ–Å–ù–´–ô
- –í —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –ö–†–ê–°–ù–´–ô: –º–∞—à–∏–Ω—ã —Å—Ç–æ—è—Ç
- –í —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –ó–ï–õ–Å–ù–´–ô: –º–∞—à–∏–Ω—ã –µ–¥—É—Ç
- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ: –ø–æ —Ç–∞–π–º–µ—Ä—É
```

### –ù–∞—à–∞ –ø—Ä–æ–≥—Ä–∞–º–º–∞

```
–°–æ—Å—Ç–æ—è–Ω–∏—è: MAP_EDIT, ROBOT
- –í —Å–æ—Å—Ç–æ—è–Ω–∏–∏ MAP_EDIT:
  ‚úÖ –ú—ã—à—å —Ä–∏—Å—É–µ—Ç –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è
  ‚ùå WASD –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç
  ‚ùå –†–æ–±–æ—Ç –Ω–µ –¥–≤–∏–≥–∞–µ—Ç—Å—è

- –í —Å–æ—Å—Ç–æ—è–Ω–∏–∏ ROBOT:
  ‚ùå –ú—ã—à—å –Ω–µ —Ä–∏—Å—É–µ—Ç
  ‚úÖ WASD —É–ø—Ä–∞–≤–ª—è—é—Ç —Ä–æ–±–æ—Ç–æ–º
  ‚úÖ –†–æ–±–æ—Ç –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∏ –¥–≤–∏–≥–∞–µ—Ç—Å—è

–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ: –∫–ª–∞–≤–∏—à–∞ TAB
```

---

## üß† –¢–µ–æ—Ä–∏—è: Enum –≤ Python

**Enum (enumeration)** ‚Äî —ç—Ç–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Ç–∏–ø –¥–ª—è –Ω–∞–±–æ—Ä–∞ –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã—Ö –∫–æ–Ω—Å—Ç–∞–Ω—Ç.

```python
from enum import Enum

class Color(Enum):
    RED = "red"
    GREEN = "green"
    BLUE = "blue"

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
current_color = Color.RED
print(current_color)  # Color.RED
print(current_color.value)  # "red"

# –°—Ä–∞–≤–Ω–µ–Ω–∏–µ
if current_color == Color.RED:
    print("–ö—Ä–∞—Å–Ω—ã–π!")
```

**–ó–∞—á–µ–º enum?**
- ‚úÖ –ò–∑–±–µ–≥–∞–µ–º –æ–ø–µ—á–∞—Ç–æ–∫ (Color.RED –≤–º–µ—Å—Ç–æ —Å—Ç—Ä–æ–∫–∏ "red")
- ‚úÖ –ê–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –≤ IDE
- ‚úÖ –Ø–≤–Ω—ã–π –Ω–∞–±–æ—Ä –≤–æ–∑–º–æ–∂–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π

---

## üìù –ó–∞–¥–∞–Ω–∏–µ 3.1: –°–æ–∑–¥–∞—ë–º mode_manager.py

–°–æ–∑–¥–∞–¥–∏–º –∫–ª–∞—Å—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞–º–∏ —Ä–∞–±–æ—Ç—ã.

**–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `mode_manager.py`:**

```python
"""–ú–æ–¥—É–ª—å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞–º–∏ —Ä–∞–±–æ—Ç—ã –ø—Ä–æ–≥—Ä–∞–º–º—ã"""
from enum import Enum


class Mode(Enum):
    """–†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã –ø—Ä–æ–≥—Ä–∞–º–º—ã"""
    MAP_EDIT = "map_edit"  # –†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–∞—Ä—Ç—ã
    ROBOT = "robot"        # –†–µ–∂–∏–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–æ–±–æ—Ç–æ–º


class ModeManager:
    """–ö–ª–∞—Å—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ–º —Ä–µ–∂–∏–º–æ–≤"""

    def __init__(self, initial_mode=Mode.MAP_EDIT):
        """
        –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞ —Ä–µ–∂–∏–º–æ–≤

        Args:
            initial_mode: –Ω–∞—á–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é MAP_EDIT)
        """
        # TODO: –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ç–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º
        self.current_mode = ___

    def toggle_mode(self):
        """–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ä–µ–∂–∏–º –Ω–∞ –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω—ã–π"""
        # TODO: –ï—Å–ª–∏ —Ç–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º MAP_EDIT, –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º –Ω–∞ ROBOT
        if self.current_mode == Mode.___:
            self.current_mode = Mode.___
            print("–†–µ–∂–∏–º: –†–û–ë–û–¢ (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ WASD)")

        # TODO: –ò–Ω–∞—á–µ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º –Ω–∞ MAP_EDIT
        else:
            self.current_mode = Mode.___
            print("–†–µ–∂–∏–º: –†–ï–î–ê–ö–¢–û–† –ö–ê–†–¢–´")

    def is_map_mode(self):
        """–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –∞–∫—Ç–∏–≤–µ–Ω –ª–∏ —Ä–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–∞—Ä—Ç—ã"""
        # TODO: –í–µ—Ä–Ω–∏—Ç–µ True, –µ—Å–ª–∏ —Ç–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º MAP_EDIT
        return self.current_mode == Mode.___

    def is_robot_mode(self):
        """–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –∞–∫—Ç–∏–≤–µ–Ω –ª–∏ —Ä–µ–∂–∏–º —Ä–æ–±–æ—Ç–∞"""
        # TODO: –í–µ—Ä–Ω–∏—Ç–µ True, –µ—Å–ª–∏ —Ç–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º ROBOT
        return self.current_mode == Mode.___

    def get_mode_name(self):
        """–ü–æ–ª—É—á–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ —Ä–µ–∂–∏–º–∞"""
        if self.current_mode == Mode.MAP_EDIT:
            return "MAP EDIT"
        else:
            return "ROBOT"
```

**–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ñ–∞–π–ª.**

---

## ‚úÖ –ó–∞–¥–∞–Ω–∏–µ 3.2: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ ModeManager

**–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `test_mode_manager.py`:**

```python
"""–¢–µ—Å—Ç ModeManager"""
from mode_manager import ModeManager, Mode

# –°–æ–∑–¥–∞—ë–º –º–µ–Ω–µ–¥–∂–µ—Ä —Ä–µ–∂–∏–º–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é MAP_EDIT)
mode_manager = ModeManager()

print("=== –¢–ï–°–¢ 1: –ù–∞—á–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º ===")
print(f"–¢–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º: {mode_manager.get_mode_name()}")
print(f"–≠—Ç–æ —Ä–µ–∂–∏–º –∫–∞—Ä—Ç—ã? {mode_manager.is_map_mode()}")
print(f"–≠—Ç–æ —Ä–µ–∂–∏–º —Ä–æ–±–æ—Ç–∞? {mode_manager.is_robot_mode()}")

print("\n=== –¢–ï–°–¢ 2: –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ ===")
mode_manager.toggle_mode()
print(f"–¢–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º: {mode_manager.get_mode_name()}")
print(f"–≠—Ç–æ —Ä–µ–∂–∏–º –∫–∞—Ä—Ç—ã? {mode_manager.is_map_mode()}")
print(f"–≠—Ç–æ —Ä–µ–∂–∏–º —Ä–æ–±–æ—Ç–∞? {mode_manager.is_robot_mode()}")

print("\n=== –¢–ï–°–¢ 3: –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –æ–±—Ä–∞—Ç–Ω–æ ===")
mode_manager.toggle_mode()
print(f"–¢–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º: {mode_manager.get_mode_name()}")

print("\n=== –¢–ï–°–¢ 4: –ù–µ—Å–∫–æ–ª—å–∫–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–π ===")
for i in range(4):
    mode_manager.toggle_mode()

print("\n‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã!")
```

**–ó–∞–ø—É—Å—Ç–∏—Ç–µ:**

```bash
python test_mode_manager.py
```

**–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:**

```
=== –¢–ï–°–¢ 1: –ù–∞—á–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º ===
–¢–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º: MAP EDIT
–≠—Ç–æ —Ä–µ–∂–∏–º –∫–∞—Ä—Ç—ã? True
–≠—Ç–æ —Ä–µ–∂–∏–º —Ä–æ–±–æ—Ç–∞? False

=== –¢–ï–°–¢ 2: –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ ===
–†–µ–∂–∏–º: –†–û–ë–û–¢ (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ WASD)
–¢–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º: ROBOT
–≠—Ç–æ —Ä–µ–∂–∏–º –∫–∞—Ä—Ç—ã? False
–≠—Ç–æ —Ä–µ–∂–∏–º —Ä–æ–±–æ—Ç–∞? True

=== –¢–ï–°–¢ 3: –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –æ–±—Ä–∞—Ç–Ω–æ ===
–†–µ–∂–∏–º: –†–ï–î–ê–ö–¢–û–† –ö–ê–†–¢–´
–¢–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º: MAP EDIT

=== –¢–ï–°–¢ 4: –ù–µ—Å–∫–æ–ª—å–∫–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–π ===
–†–µ–∂–∏–º: –†–û–ë–û–¢ (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ WASD)
–†–µ–∂–∏–º: –†–ï–î–ê–ö–¢–û–† –ö–ê–†–¢–´
–†–µ–∂–∏–º: –†–û–ë–û–¢ (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ WASD)
–†–µ–∂–∏–º: –†–ï–î–ê–ö–¢–û–† –ö–ê–†–¢–´

‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã!
```

---

## üìù –ó–∞–¥–∞–Ω–∏–µ 3.3: –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ–º —Ä–µ–∂–∏–º—ã –≤ InputManager

–¢–µ–ø–µ—Ä—å InputManager –¥–æ–ª–∂–µ–Ω –≤–µ—Å—Ç–∏ —Å–µ–±—è –ø–æ-—Ä–∞–∑–Ω–æ–º—É –≤ —Ä–∞–∑–Ω—ã—Ö —Ä–µ–∂–∏–º–∞—Ö.

**–û—Ç–∫—Ä–æ–π—Ç–µ `input_manager.py` –∏ –æ–±–Ω–æ–≤–∏—Ç–µ:**

### –®–∞–≥ 1: –î–æ–±–∞–≤—å—Ç–µ mode_manager –≤ __init__

```python
    def __init__(self, grid, history, running_flag, mode_manager):
        """
        –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –≤–≤–æ–¥–∞

        Args:
            grid: –æ–±—ä–µ–∫—Ç Grid
            history: –æ–±—ä–µ–∫—Ç History
            running_flag: —Å–ø–∏—Å–æ–∫ [True/False] –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ü–∏–∫–ª–æ–º
            mode_manager: –æ–±—ä–µ–∫—Ç ModeManager  # <-- –î–û–ë–ê–í–õ–ï–ù–û
        """
        self.grid = grid
        self.history = history
        self.running_flag = running_flag
        self.mode_manager = mode_manager  # <-- –î–û–ë–ê–í–õ–ï–ù–û

        # –§–ª–∞–≥–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –º—ã—à–∏
        self.left_mouse_pressed = False
        self.right_mouse_pressed = False
        self.last_drawn_cell = None
        self.last_erased_cell = None

        # –°–ª–æ–≤–∞—Ä—å –ø—Ä–∏–≤—è–∑–æ–∫ –∫–ª–∞–≤–∏—à
        self.key_bindings = {}

        # –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –ø—Ä–∏–≤—è–∑–∫–∏ –∫–ª–∞–≤–∏—à
        self._setup_default_bindings()
```

### –®–∞–≥ 2: –î–æ–±–∞–≤—å—Ç–µ –ø—Ä–∏–≤—è–∑–∫—É –∫–ª–∞–≤–∏—à–∏ TAB

–í –º–µ—Ç–æ–¥–µ `_setup_default_bindings()` –¥–æ–±–∞–≤—å—Ç–µ:

```python
    def _setup_default_bindings(self):
        """–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–∏–≤—è–∑–∫–∏ –∫–ª–∞–≤–∏—à –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é"""
        self.bind_key(pygame.K_ESCAPE, "–≤—ã—Ö–æ–¥", self._exit_program)
        self.bind_key(pygame.K_h, "–ø–æ–∫–∞–∑–∞—Ç—å —Å–ø—Ä–∞–≤–∫—É", self._show_help)
        self.bind_key(pygame.K_z, "–æ—Ç–º–µ–Ω–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–µ–µ –¥–µ–π—Å—Ç–≤–∏–µ", self._undo_action)
        self.bind_key(pygame.K_c, "–æ—á–∏—Å—Ç–∏—Ç—å –≤—Å—ë", self._clear_all)
        # TODO: –î–æ–±–∞–≤—å—Ç–µ –ø—Ä–∏–≤—è–∑–∫—É TAB –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞
        self.bind_key(pygame.K_TAB, "–ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ä–µ–∂–∏–º", self.___)
```

### –®–∞–≥ 3: –î–æ–±–∞–≤—å—Ç–µ –º–µ—Ç–æ–¥ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞

–í –∫–æ–Ω–µ—Ü –∫–ª–∞—Å—Å–∞ InputManager –¥–æ–±–∞–≤—å—Ç–µ:

```python
    def _toggle_mode(self):
        """–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã"""
        # TODO: –í—ã–∑–æ–≤–∏—Ç–µ –º–µ—Ç–æ–¥ toggle_mode —É mode_manager
        self.mode_manager.___()
```

### –®–∞–≥ 4: –û–±–Ω–æ–≤–∏—Ç–µ handle_mouse_motion

–†–∏—Å–æ–≤–∞–Ω–∏–µ –º—ã—à—å—é –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å **—Ç–æ–ª—å–∫–æ –≤ —Ä–µ–∂–∏–º–µ MAP_EDIT**:

```python
    def handle_mouse_motion(self, mouse_x, mouse_y):
        """
        –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –¥–≤–∏–∂–µ–Ω–∏–µ –º—ã—à–∏ (—Ä–∏—Å–æ–≤–∞–Ω–∏–µ/—Å—Ç–∏—Ä–∞–Ω–∏–µ)

        Args:
            mouse_x: –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ X –º—ã—à–∏
            mouse_y: –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ Y –º—ã—à–∏
        """
        # TODO: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –º—ã –≤ —Ä–µ–∂–∏–º–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–∞—Ä—Ç—ã
        # –ï—Å–ª–∏ –Ω–µ—Ç - –≤—ã—Ö–æ–¥–∏–º –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏
        if not self.mode_manager.___():
            return

        # –†–∏—Å–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ –∑–∞–∂–∞—Ç–æ–π –ª–µ–≤–æ–π –∫–Ω–æ–ø–∫–µ
        if self.left_mouse_pressed:
            cell = self.grid.get_cell_at_position(mouse_x, mouse_y)
            if cell is not None:
                col, row = cell
                if cell != self.last_drawn_cell:
                    self.grid.fill_cell(col, row)
                    self.history.add_action({'type': 'fill', 'cell': (col, row)})
                    self.last_drawn_cell = cell

        # –°—Ç–∏—Ä–∞–Ω–∏–µ –ø—Ä–∏ –∑–∞–∂–∞—Ç–æ–π –ø—Ä–∞–≤–æ–π –∫–Ω–æ–ø–∫–µ
        if self.right_mouse_pressed:
            cell = self.grid.get_cell_at_position(mouse_x, mouse_y)
            if cell is not None:
                col, row = cell
                if cell != self.last_erased_cell:
                    if self.grid.is_cell_filled(col, row):
                        self.grid.clear_cell(col, row)
                        self.history.add_action({'type': 'erase', 'cell': (col, row)})
                    self.last_erased_cell = cell
```

**–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ñ–∞–π–ª.**

---

## üìù –ó–∞–¥–∞–Ω–∏–µ 3.4: –û–±–Ω–æ–≤–ª—è–µ–º main.py

–ü–æ–¥–∫–ª—é—á–∏–º ModeManager –∫ –ø—Ä–æ–≥—Ä–∞–º–º–µ.

**–û—Ç–∫—Ä–æ–π—Ç–µ `main.py` –∏ –≤–Ω–µ—Å–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:**

### –®–∞–≥ 1: –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ ModeManager

```python
from grid import Grid
from history import History
from renderer import Renderer
from input_manager import InputManager
from mode_manager import ModeManager  # <-- –î–û–ë–ê–í–õ–ï–ù–û
from robot import Robot                # <-- –î–û–ë–ê–í–õ–ï–ù–û
```

### –®–∞–≥ 2: –°–æ–∑–¥–∞–π—Ç–µ –æ–±—ä–µ–∫—Ç—ã

```python
    # –°–æ–∑–¥–∞—ë–º –æ–±—ä–µ–∫—Ç—ã
    grid = Grid(WIDTH, HEIGHT, CELL_WIDTH, CELL_HEIGHT, offset_x=0)
    history = History()
    renderer = Renderer(screen)
    mode_manager = ModeManager()  # <-- –î–û–ë–ê–í–õ–ï–ù–û

    # –°–æ–∑–¥–∞—ë–º —Ä–æ–±–æ—Ç–∞ –≤ —Ü–µ–Ω—Ç—Ä–µ –∫–∞—Ä—Ç—ã
    robot = Robot(
        x=GRID_COLS / 2.0,
        y=GRID_ROWS / 2.0,
        angle=0.0,
        radius=1.0
    )

    # –°–æ–∑–¥–∞—ë–º –º–µ–Ω–µ–¥–∂–µ—Ä –≤–≤–æ–¥–∞ (—Ç–µ–ø–µ—Ä—å —Å mode_manager)
    input_manager = InputManager(grid, history, running, mode_manager)  # <-- –ò–ó–ú–ï–ù–ï–ù–û
```

### –®–∞–≥ 3: –£—Å–ª–æ–≤–Ω–∞—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∞ —Ä–æ–±–æ—Ç–∞

–í –∏–≥—Ä–æ–≤–æ–º —Ü–∏–∫–ª–µ –¥–æ–±–∞–≤—å—Ç–µ —É—Å–ª–æ–≤–∏–µ:

```python
    # –ò–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
    while running[0]:
        # –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π
        for event in pygame.event.get():
            if event.type == pygame.QUIT:
                running[0] = False
            else:
                input_manager.handle_event(event)

        # –ü–æ–ª—É—á–∞–µ–º –ø–æ–∑–∏—Ü–∏—é –º—ã—à–∏
        mouse_x, mouse_y = pygame.mouse.get_pos()

        # TODO: –û–±–Ω–æ–≤–ª—è–µ–º —Ä–æ–±–æ—Ç–∞ —Ç–æ–ª—å–∫–æ –≤ —Ä–µ–∂–∏–º–µ ROBOT
        if mode_manager.___():
            robot.set_velocities(linear=5.0, angular=1.0)  # –≤—Ä–µ–º–µ–Ω–Ω–æ - –ø–æ –∫—Ä—É–≥—É
            robot.update(dt=0.016)
            robot.clamp_position(robot.radius, grid.cols - robot.radius,
                                robot.radius, grid.rows - robot.radius)

        # TODO: –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–ª–µ—Ç–∫—É –ø–æ–¥ –∫—É—Ä—Å–æ—Ä–æ–º —Ç–æ–ª—å–∫–æ –≤ —Ä–µ–∂–∏–º–µ MAP_EDIT
        hover_cell = None
        if mode_manager.___():
            hover_cell = grid.get_cell_at_position(mouse_x, mouse_y)
            input_manager.handle_mouse_motion(mouse_x, mouse_y)

        # –û—Ç—Ä–∏—Å–æ–≤–∫–∞
        renderer.draw_grid(grid, hover_cell=hover_cell)

        # TODO: –†–∏—Å—É–µ–º —Ä–æ–±–æ—Ç–∞ —Ç–æ–ª—å–∫–æ –≤ —Ä–µ–∂–∏–º–µ ROBOT
        if mode_manager.___():
            renderer.draw_robot(robot, grid)

        # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —ç–∫—Ä–∞–Ω–∞
        pygame.display.flip()
        clock.tick(60)
```

**–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ñ–∞–π–ª.**

---

## ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤

**–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ–≥—Ä–∞–º–º—É:**

```bash
python main.py
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**

1. **–ù–∞—á–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º (MAP_EDIT):**
   - –ú—ã—à—å —Ä–∏—Å—É–µ—Ç –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è ‚úÖ
   - –†–æ–±–æ—Ç–∞ –Ω–µ –≤–∏–¥–Ω–æ ‚úÖ

2. **–ù–∞–∂–º–∏—Ç–µ TAB:**
   - –í –∫–æ–Ω—Å–æ–ª–∏: "–†–µ–∂–∏–º: –†–û–ë–û–¢ (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ WASD)"
   - –ú—ã—à—å –±–æ–ª—å—à–µ –Ω–µ —Ä–∏—Å—É–µ—Ç ‚úÖ
   - –†–æ–±–æ—Ç –ø–æ—è–≤–∏–ª—Å—è –∏ –µ–¥–µ—Ç –ø–æ –∫—Ä—É–≥—É ‚úÖ

3. **–ù–∞–∂–º–∏—Ç–µ TAB –µ—â—ë —Ä–∞–∑:**
   - –í –∫–æ–Ω—Å–æ–ª–∏: "–†–µ–∂–∏–º: –†–ï–î–ê–ö–¢–û–† –ö–ê–†–¢–´"
   - –ú—ã—à—å —Å–Ω–æ–≤–∞ —Ä–∏—Å—É–µ—Ç ‚úÖ
   - –†–æ–±–æ—Ç –∏—Å—á–µ–∑ ‚úÖ

**–û—Ç–ª–∏—á–Ω–æ! –†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç–∞—é—Ç! üéâ**

---

## üéì –ß—Ç–æ –º—ã —É–∑–Ω–∞–ª–∏?

1. ‚úÖ **–ü–∞—Ç—Ç–µ—Ä–Ω State Machine** ‚Äî –ø—Ä–æ–≥—Ä–∞–º–º–∞ —Å —Ä–∞–∑–Ω—ã–º–∏ —Ä–µ–∂–∏–º–∞–º–∏ —Ä–∞–±–æ—Ç—ã
2. ‚úÖ **Enum –≤ Python** ‚Äî –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è —Ä–µ–∂–∏–º–æ–≤
3. ‚úÖ **–£—Å–ª–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞** ‚Äî —Ä–∞–∑–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –≤ —Ä–∞–∑–Ω—ã—Ö —Ä–µ–∂–∏–º–∞—Ö
4. ‚úÖ **–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–π** ‚Äî –º–µ—Ç–æ–¥ `toggle_mode()`
5. ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è** ‚Äî –º–µ—Ç–æ–¥—ã `is_map_mode()`, `is_robot_mode()`
6. ‚úÖ **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** ‚Äî –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç –≤–º–µ—Å—Ç–µ

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥

–†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç–∞—é—Ç, –Ω–æ —Ä–æ–±–æ—Ç –ø–æ–∫–∞ –µ–¥–µ—Ç —Å–∞–º –ø–æ —Å–µ–±–µ. –ü–æ—Ä–∞ –¥–∞—Ç—å –∏–≥—Ä–æ–∫—É —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ!

**–î–∞–ª—å—à–µ:** –î–æ–±–∞–≤–∏–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–æ–±–æ—Ç–æ–º –∫–ª–∞–≤–∏—à–∞–º–∏ WASD!
