# üëÅÔ∏è –ë–ª–æ–∫ 5: –ó–æ–Ω—ã –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π

## üéØ –¶–µ–ª—å

–†–æ–±–æ—Ç —É–º–µ–µ—Ç –µ–∑–¥–∏—Ç—å, –Ω–æ **–ø—Ä–æ–µ–∑–∂–∞–µ—Ç —Å–∫–≤–æ–∑—å –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è** –∫–∞–∫ –ø—Ä–∏–∑—Ä–∞–∫! üëª

–ß—Ç–æ–±—ã –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –µ–≥–æ –ø–µ—Ä–µ–¥ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–µ–º, —Ä–æ–±–æ—Ç—É –Ω—É–∂–Ω–æ "–≤–∏–¥–µ—Ç—å" –æ–∫—Ä—É–∂–µ–Ω–∏–µ. –°–æ–∑–¥–∞–¥–∏–º **–∑–æ–Ω—ã –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è**:

1. **–ó–æ–Ω–∞ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è** (—Ä–∞–¥–∏—É—Å 2√óradius) ‚Äî –≤—Å–µ –∫–ª–µ—Ç–∫–∏ –≤–æ–∫—Ä—É–≥ —Ä–æ–±–æ—Ç–∞
2. **–ü–µ—Ä–µ–¥–Ω–∏–π —Å–µ–∫—Ç–æ—Ä** (¬±45¬∞ –≤–ø–µ—Ä–µ–¥–∏) ‚Äî –∫–ª–µ—Ç–∫–∏, –≤ –∫–æ—Ç–æ—Ä—ã–µ —Ä–æ–±–æ—Ç –º–æ–∂–µ—Ç –≤—Ä–µ–∑–∞—Ç—å—Å—è –ø—Ä–∏ –¥–≤–∏–∂–µ–Ω–∏–∏ –≤–ø–µ—Ä—ë–¥

---

## üß† –¢–µ–æ—Ä–∏—è: –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É —Ç–æ—á–∫–∞–º–∏

–ß—Ç–æ–±—ã –Ω–∞–π—Ç–∏ –∫–ª–µ—Ç–∫–∏ –≤ —Ä–∞–¥–∏—É—Å–µ –æ—Ç —Ä–æ–±–æ—Ç–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º **—Ñ–æ—Ä–º—É–ª—É –ï–≤–∫–ª–∏–¥–æ–≤–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è**:

```
distance = ‚àö((x‚ÇÇ - x‚ÇÅ)¬≤ + (y‚ÇÇ - y‚ÇÅ)¬≤)
```

–í Python:

```python
import math

# –ü–æ–∑–∏—Ü–∏—è —Ä–æ–±–æ—Ç–∞
robot_x = 10.5
robot_y = 15.3

# –¶–µ–Ω—Ç—Ä –∫–ª–µ—Ç–∫–∏ (col, row)
cell_x = 12.0 + 0.5  # col + 0.5 (—Ü–µ–Ω—Ç—Ä –∫–ª–µ—Ç–∫–∏)
cell_y = 16.0 + 0.5  # row + 0.5

# –í—ã—á–∏—Å–ª—è–µ–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ
dx = cell_x - robot_x
dy = cell_y - robot_y
distance = math.sqrt(dx*dx + dy*dy)

# –ï—Å–ª–∏ distance <= detection_radius, –∫–ª–µ—Ç–∫–∞ –≤ –∑–æ–Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è
```

**–ü–æ—á–µ–º—É `col + 0.5`?**
- –ö–ª–µ—Ç–∫–∞ —Å –∏–Ω–¥–µ–∫—Å–æ–º (12, 16) –∑–∞–Ω–∏–º–∞–µ—Ç –∫–≤–∞–¥—Ä–∞—Ç –æ—Ç (12.0, 16.0) –¥–æ (13.0, 17.0)
- –¶–µ–Ω—Ç—Ä –∫–ª–µ—Ç–∫–∏: (12.5, 16.5)
- –ú—ã –∏–∑–º–µ—Ä—è–µ–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–æ —Ü–µ–Ω—Ç—Ä–∞ –∫–ª–µ—Ç–∫–∏

---

## üß† –¢–µ–æ—Ä–∏—è: –£–≥–ª—ã –∏ —Å–µ–∫—Ç–æ—Ä–∞

–ß—Ç–æ–±—ã –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å **–ø–µ—Ä–µ–¥–Ω–∏–π —Å–µ–∫—Ç–æ—Ä** (¬±45¬∞ –≤–ø–µ—Ä–µ–¥–∏), –Ω—É–∂–Ω–æ:

1. –í—ã—á–∏—Å–ª–∏—Ç—å —É–≥–æ–ª –æ—Ç —Ä–æ–±–æ—Ç–∞ –¥–æ –∫–ª–µ—Ç–∫–∏: `cell_angle = atan2(dy, dx)`
2. –í—ã—á–∏—Å–ª–∏—Ç—å —Ä–∞–∑–Ω–∏—Ü—É –º–µ–∂–¥—É —É–≥–ª–æ–º —Ä–æ–±–æ—Ç–∞ –∏ —É–≥–ª–æ–º –∫–ª–µ—Ç–∫–∏: `angle_diff = cell_angle - robot.angle`
3. –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å `angle_diff` –≤ –¥–∏–∞–ø–∞–∑–æ–Ω [-œÄ, œÄ]
4. –ï—Å–ª–∏ `|angle_diff| <= 45¬∞` (0.785 —Ä–∞–¥–∏–∞–Ω), –∫–ª–µ—Ç–∫–∞ –≤ –ø–µ—Ä–µ–¥–Ω–µ–º —Å–µ–∫—Ç–æ—Ä–µ

```
         –ü–µ—Ä–µ–¥–Ω–∏–π —Å–µ–∫—Ç–æ—Ä (90¬∞)
              ¬±45¬∞ –æ—Ç angle

         \         |         /
          \        |        /
           \   —Ä–æ–±–æ—Ç ‚Üí     /
            \      ‚Ä¢      /
             \           /
              \         /
```

---

## üìù –ó–∞–¥–∞–Ω–∏–µ 5.1: –ú–µ—Ç–æ–¥ get_detection_zone_cells

–î–æ–±–∞–≤–∏–º –º–µ—Ç–æ–¥—ã –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–ª–µ—Ç–æ–∫ –≤ –∑–æ–Ω–∞—Ö –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è.

**–û—Ç–∫—Ä–æ–π—Ç–µ `robot.py` –∏ –¥–æ–±–∞–≤—å—Ç–µ –≤ –∫–æ–Ω–µ—Ü –∫–ª–∞—Å—Å–∞ Robot:**

```python
    def get_detection_zone_cells(self, grid):
        """
        –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∫–ª–µ—Ç–∫–∏ –≤ –∑–æ–Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è (—Ä–∞–¥–∏—É—Å 2*radius –æ—Ç —Ä–æ–±–æ—Ç–∞)

        Args:
            grid: –æ–±—ä–µ–∫—Ç Grid

        Returns:
            set –∫–ª–µ—Ç–æ–∫ (col, row) –≤ –∑–æ–Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è
        """
        cells = set()

        # TODO: –í—ã—á–∏—Å–ª–∏—Ç–µ —Ä–∞–¥–∏—É—Å –∑–æ–Ω—ã –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è (2 * self.radius)
        detection_radius = 2 * self.___

        # TODO: –í—ã—á–∏—Å–ª–∏—Ç–µ –≥—Ä–∞–Ω–∏—Ü—ã –∫–≤–∞–¥—Ä–∞—Ç–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
        # –ú—ã –ø—Ä–æ–≤–µ—Ä—è–µ–º –∫–≤–∞–¥—Ä–∞—Ç –≤–æ–∫—Ä—É–≥ —Ä–æ–±–æ—Ç–∞, –∞ –ø–æ—Ç–æ–º —Ñ–∏–ª—å—Ç—Ä—É–µ–º –ø–æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—é
        min_col = int(self.x - detection_radius)
        max_col = int(self.x + detection_radius) + 1
        min_row = int(self.y - ___)
        max_row = int(self.y + ___) + 1

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—É—é –∫–ª–µ—Ç–∫—É –≤ –∫–≤–∞–¥—Ä–∞—Ç–µ
        for col in range(min_col, max_col):
            for row in range(min_row, max_row):
                # TODO: –ü—Ä–æ–≤–µ—Ä—è–µ–º –≥—Ä–∞–Ω–∏—Ü—ã —Å–µ—Ç–∫–∏
                if 0 <= col < grid.___ and 0 <= row < grid.___:
                    # –í—ã—á–∏—Å–ª—è–µ–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –æ—Ç —Ü–µ–Ω—Ç—Ä–∞ —Ä–æ–±–æ—Ç–∞ –¥–æ —Ü–µ–Ω—Ç—Ä–∞ –∫–ª–µ—Ç–∫–∏
                    # –¶–µ–Ω—Ç—Ä –∫–ª–µ—Ç–∫–∏: (col + 0.5, row + 0.5)
                    dx = (col + 0.5) - self.___
                    dy = (row + 0.5) - self.___

                    # TODO: –í—ã—á–∏—Å–ª–∏—Ç–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –ø–æ —Ñ–æ—Ä–º—É–ª–µ –ï–≤–∫–ª–∏–¥–∞
                    # distance = ‚àö(dx¬≤ + dy¬≤)
                    import math
                    distance = math.sqrt(dx*dx + dy*dy)

                    # TODO: –ï—Å–ª–∏ –∫–ª–µ—Ç–∫–∞ –≤ —Ä–∞–¥–∏—É—Å–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è - –¥–æ–±–∞–≤–ª—è–µ–º
                    if distance <= ___:  # detection_radius
                        cells.add((col, row))

        return cells

    def get_forward_sector_cells(self, grid):
        """
        –ü–æ–ª—É—á–∏—Ç—å –∫–ª–µ—Ç–∫–∏ –≤ —Å–µ–∫—Ç–æ—Ä–µ ¬±45¬∞ –≤–ø–µ—Ä–µ–¥–∏ —Ä–æ–±–æ—Ç–∞ (–≤ –∑–æ–Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è)

        Args:
            grid: –æ–±—ä–µ–∫—Ç Grid

        Returns:
            set –∫–ª–µ—Ç–æ–∫ (col, row) –≤ –ø–µ—Ä–µ–¥–Ω–µ–º —Å–µ–∫—Ç–æ—Ä–µ
        """
        cells = set()
        detection_radius = 2 * self.radius

        # TODO: –û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ —É–≥–æ–ª —Å–µ–∫—Ç–æ—Ä–∞ (¬±45¬∞ = 90¬∞ –≤—Å–µ–≥–æ)
        # 45¬∞ –≤ —Ä–∞–¥–∏–∞–Ω–∞—Ö = œÄ/4 ‚âà 0.785
        import math
        sector_angle = math.radians(___)  # 45

        # –í—ã—á–∏—Å–ª—è–µ–º –≥—Ä–∞–Ω–∏—Ü—ã –∫–≤–∞–¥—Ä–∞—Ç–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
        min_col = int(self.x - detection_radius)
        max_col = int(self.x + detection_radius) + 1
        min_row = int(self.y - detection_radius)
        max_row = int(self.y + detection_radius) + 1

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—É—é –∫–ª–µ—Ç–∫—É –≤ –∫–≤–∞–¥—Ä–∞—Ç–µ
        for col in range(min_col, max_col):
            for row in range(min_row, max_row):
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º –≥—Ä–∞–Ω–∏—Ü—ã —Å–µ—Ç–∫–∏
                if 0 <= col < grid.cols and 0 <= row < grid.rows:
                    # –í–µ–∫—Ç–æ—Ä –æ—Ç —Ä–æ–±–æ—Ç–∞ –¥–æ –∫–ª–µ—Ç–∫–∏
                    dx = (col + 0.5) - self.x
                    dy = (row + 0.5) - self.y
                    distance = math.sqrt(dx*dx + dy*dy)

                    # –ö–ª–µ—Ç–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤ —Ä–∞–¥–∏—É—Å–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è
                    if distance <= detection_radius and distance > 0.1:
                        # TODO: –í—ã—á–∏—Å–ª–∏—Ç–µ —É–≥–æ–ª –æ—Ç —Ä–æ–±–æ—Ç–∞ –¥–æ –∫–ª–µ—Ç–∫–∏
                        # atan2(dy, dx) –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —É–≥–æ–ª –≤ —Ä–∞–¥–∏–∞–Ω–∞—Ö
                        cell_angle = math.___(dy, dx)

                        # TODO: –í—ã—á–∏—Å–ª–∏—Ç–µ —Ä–∞–∑–Ω–∏—Ü—É —É–≥–ª–æ–≤
                        angle_diff = cell_angle - self.___

                        # –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º —É–≥–æ–ª –≤ –¥–∏–∞–ø–∞–∑–æ–Ω [-œÄ, œÄ]
                        while angle_diff > math.pi:
                            angle_diff -= 2 * math.pi
                        while angle_diff < -math.pi:
                            angle_diff += 2 * math.pi

                        # TODO: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –ø–æ–ø–∞–¥–∞–µ—Ç –ª–∏ –∫–ª–µ—Ç–∫–∞ –≤ —Å–µ–∫—Ç–æ—Ä ¬±45¬∞
                        if abs(angle_diff) <= ___:  # sector_angle
                            cells.add((col, row))

        return cells
```

**–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ñ–∞–π–ª.**

---

## üìù –ó–∞–¥–∞–Ω–∏–µ 5.2: –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∑–æ–Ω

–î–æ–±–∞–≤–∏–º –æ—Ç—Ä–∏—Å–æ–≤–∫—É –∑–æ–Ω –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è, —á—Ç–æ–±—ã –≤–∏–¥–µ—Ç—å, —á—Ç–æ "–≤–∏–¥–∏—Ç" —Ä–æ–±–æ—Ç.

**–û—Ç–∫—Ä–æ–π—Ç–µ `renderer.py` –∏ –¥–æ–±–∞–≤—å—Ç–µ –º–µ—Ç–æ–¥:**

```python
    def draw_detection_zones(self, robot, grid):
        """
        –û—Ç—Ä–∏—Å–æ–≤–∞—Ç—å –∑–æ–Ω—ã –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è —Ä–æ–±–æ—Ç–∞

        Args:
            robot: –æ–±—ä–µ–∫—Ç Robot
            grid: –æ–±—ä–µ–∫—Ç Grid
        """
        # –ü–æ–ª—É—á–∞–µ–º –∫–ª–µ—Ç–∫–∏ –≤ –∑–æ–Ω–∞—Ö
        detection_cells = robot.get_detection_zone_cells(grid)
        forward_cells = robot.get_forward_sector_cells(grid)

        # TODO: –†–∏—Å—É–µ–º –∑–æ–Ω—É –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è (—Å–≤–µ—Ç–ª–æ-—Å–∏–Ω–∏–π)
        for col, row in detection_cells:
            x = col * grid.cell_width + grid.offset_x
            y = row * grid.cell_height

            # –°–æ–∑–¥–∞—ë–º –ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—É—é –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç—å
            surface = pygame.Surface((grid.cell_width, grid.cell_height))
            surface.set_alpha(___)  # 50 - –ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å
            surface.fill((100, 150, 255))  # —Å–≤–µ—Ç–ª–æ-—Å–∏–Ω–∏–π
            self.screen.blit(surface, (x, y))

        # TODO: –†–∏—Å—É–µ–º –ø–µ—Ä–µ–¥–Ω–∏–π —Å–µ–∫—Ç–æ—Ä (–∂—ë–ª—Ç—ã–π) –ø–æ–≤–µ—Ä—Ö –∑–æ–Ω—ã –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è
        for col, row in ___:  # forward_cells
            x = col * grid.cell_width + grid.offset_x
            y = row * grid.cell_height

            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ –ª–∏ –∫–ª–µ—Ç–∫–∞ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–µ–º
            if grid.is_cell_filled(col, row):
                # –ü—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–µ –≤–ø–µ—Ä–µ–¥–∏ - –∫—Ä–∞—Å–Ω—ã–π!
                color = (255, 100, 100)
            else:
                # –ü—É—Å—Ç–æ - –∂—ë–ª—Ç—ã–π
                color = (255, 255, 100)

            surface = pygame.Surface((grid.cell_width, grid.cell_height))
            surface.set_alpha(100)
            surface.fill(___)  # color
            self.screen.blit(surface, (x, y))
```

**–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ñ–∞–π–ª.**

---

## üìù –ó–∞–¥–∞–Ω–∏–µ 5.3: –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ–º –≤ main.py

**–û—Ç–∫—Ä–æ–π—Ç–µ `main.py` –∏ –æ–±–Ω–æ–≤–∏—Ç–µ –æ—Ç—Ä–∏—Å–æ–≤–∫—É:**

–ù–∞–π–¥–∏—Ç–µ –±–ª–æ–∫ –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ —Ä–æ–±–æ—Ç–∞ –∏ –¥–æ–±–∞–≤—å—Ç–µ –≤—ã–∑–æ–≤ draw_detection_zones:

```python
        # –†–∏—Å—É–µ–º —Ä–æ–±–æ—Ç–∞ —Ç–æ–ª—å–∫–æ –≤ —Ä–µ–∂–∏–º–µ ROBOT
        if mode_manager.is_robot_mode():
            # TODO: –°–Ω–∞—á–∞–ª–∞ —Ä–∏—Å—É–µ–º –∑–æ–Ω—ã –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è (–ø–æ–¥ —Ä–æ–±–æ—Ç–æ–º)
            renderer.___(robot, grid)

            # –ü–æ—Ç–æ–º —Ä–∏—Å—É–µ–º —Ä–æ–±–æ—Ç–∞ –ø–æ–≤–µ—Ä—Ö –∑–æ–Ω
            renderer.draw_robot(robot, grid)
```

**–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ñ–∞–π–ª.**

---

## ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–æ–Ω –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è

**–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ–≥—Ä–∞–º–º—É:**

```bash
python main.py
```

### –¢–µ—Å—Ç 1: –†–∏—Å—É–µ–º –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è

1. **–†–µ–∂–∏–º MAP_EDIT** (–Ω–∞—á–∞–ª—å–Ω—ã–π)
2. –ù–∞—Ä–∏—Å—É–π—Ç–µ —Å—Ç–µ–Ω—É –∏–∑ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π

### –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–æ–Ω—ã

1. **TAB** ‚Üí –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º –Ω–∞ —Ä–µ–∂–∏–º ROBOT
2. –£–ø—Ä–∞–≤–ª—è–π—Ç–µ —Ä–æ–±–æ—Ç–æ–º (WASD)
3. **–ù–∞–±–ª—é–¥–∞–π—Ç–µ:**
   - **–°–≤–µ—Ç–ª–æ-—Å–∏–Ω—è—è –æ–±–ª–∞—Å—Ç—å** –≤–æ–∫—Ä—É–≥ —Ä–æ–±–æ—Ç–∞ ‚Äî –∑–æ–Ω–∞ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è (—Ä–∞–¥–∏—É—Å 2) ‚úÖ
   - **–ñ—ë–ª—Ç—ã–π —Å–µ–∫—Ç–æ—Ä** –≤–ø–µ—Ä–µ–¥–∏ ‚Äî –ø–µ—Ä–µ–¥–Ω–∏–π —Å–µ–∫—Ç–æ—Ä (¬±45¬∞) ‚úÖ
   - **–ö—Ä–∞—Å–Ω—ã–µ –∫–ª–µ—Ç–∫–∏** –≤ –ø–µ—Ä–µ–¥–Ω–µ–º —Å–µ–∫—Ç–æ—Ä–µ ‚Äî –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è! ‚úÖ

### –¢–µ—Å—Ç 3: –ü–æ–≤–æ—Ä–æ—Ç

1. –ü–æ–≤–æ—Ä–∞—á–∏–≤–∞–π—Ç–µ —Ä–æ–±–æ—Ç–∞ (A/D)
2. –ü–µ—Ä–µ–¥–Ω–∏–π —Å–µ–∫—Ç–æ—Ä (–∂—ë–ª—Ç—ã–π) **–ø–æ–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è –≤–º–µ—Å—Ç–µ —Å —Ä–æ–±–æ—Ç–æ–º** ‚úÖ
3. –ó–æ–Ω–∞ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è (—Å–∏–Ω—è—è) –æ—Å—Ç–∞—ë—Ç—Å—è –∫—Ä—É–≥–ª–æ–π ‚úÖ

### –¢–µ—Å—Ç 4: –ü—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è

1. –ü–æ–¥—ä–µ–∑–∂–∞–π—Ç–µ –∫ —Å—Ç–µ–Ω–µ
2. –ö–æ–≥–¥–∞ —Å—Ç–µ–Ω–∞ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –ø–µ—Ä–µ–¥–Ω–∏–π —Å–µ–∫—Ç–æ—Ä ‚Üí **–∫–ª–µ—Ç–∫–∏ –∫—Ä–∞—Å–Ω–µ—é—Ç** ‚úÖ
3. –†–æ–±–æ—Ç –ø–æ–∫–∞ **–ø—Ä–æ–µ–∑–∂–∞–µ—Ç —Å–∫–≤–æ–∑—å —Å—Ç–µ–Ω—É** (—ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ, –∏—Å–ø—Ä–∞–≤–∏–º –≤ —Å–ª–µ–¥—É—é—â–µ–º –±–ª–æ–∫–µ)

**–û—Ç–ª–∏—á–Ω–æ! –ó–æ–Ω—ã —Ä–∞–±–æ—Ç–∞—é—Ç! üéâ**

---

## üìù –ó–∞–¥–∞–Ω–∏–µ 5.4: –ë–û–ù–£–° - –¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–°–æ–∑–¥–∞–¥–∏–º —Ç–µ—Å—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–æ–Ω –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è.

**–°–æ–∑–¥–∞–π—Ç–µ `test_detection_zones.py`:**

```python
"""–¢–µ—Å—Ç –∑–æ–Ω –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è —Ä–æ–±–æ—Ç–∞"""
from robot import Robot
from grid import Grid

# –°–æ–∑–¥–∞—ë–º —Å–µ—Ç–∫—É –∏ —Ä–æ–±–æ—Ç–∞
grid = Grid(800, 600, 10, 12, offset_x=0)
robot = Robot(x=10.0, y=10.0, angle=0.0, radius=1.0)

# –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è
grid.fill_cell(13, 10)  # –í–ø–µ—Ä–µ–¥–∏
grid.fill_cell(13, 11)
grid.fill_cell(14, 10)

print("=== –¢–ï–°–¢ 1: –ó–æ–Ω–∞ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è ===")
detection_cells = robot.get_detection_zone_cells(grid)
print(f"–ö–ª–µ—Ç–æ–∫ –≤ –∑–æ–Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è: {len(detection_cells)}")
print(f"–û–∂–∏–¥–∞–ª–æ—Å—å: ~12-16 –∫–ª–µ—Ç–æ–∫ (–∫—Ä—É–≥ —Ä–∞–¥–∏—É—Å–∞ 2)")

print("\n=== –¢–ï–°–¢ 2: –ü–µ—Ä–µ–¥–Ω–∏–π —Å–µ–∫—Ç–æ—Ä ===")
forward_cells = robot.get_forward_sector_cells(grid)
print(f"–ö–ª–µ—Ç–æ–∫ –≤ –ø–µ—Ä–µ–¥–Ω–µ–º —Å–µ–∫—Ç–æ—Ä–µ: {len(forward_cells)}")
print(f"–û–∂–∏–¥–∞–ª–æ—Å—å: ~4-6 –∫–ª–µ—Ç–æ–∫ (—Å–µ–∫—Ç–æ—Ä 90¬∞ –≤–ø–µ—Ä–µ–¥–∏)")

print("\n=== –¢–ï–°–¢ 3: –ü—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è –≤ –ø–µ—Ä–µ–¥–Ω–µ–º —Å–µ–∫—Ç–æ—Ä–µ ===")
obstacles_in_front = 0
for col, row in forward_cells:
    if grid.is_cell_filled(col, row):
        obstacles_in_front += 1
        print(f"  –ü—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–µ –≤ –∫–ª–µ—Ç–∫–µ ({col}, {row})")

print(f"\n–í—Å–µ–≥–æ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π –≤–ø–µ—Ä–µ–¥–∏: {obstacles_in_front}")
print(f"–û–∂–∏–¥–∞–ª–æ—Å—å: 3 (–º—ã –¥–æ–±–∞–≤–∏–ª–∏ 3 –∫–ª–µ—Ç–∫–∏ –≤–ø–µ—Ä–µ–¥–∏)")

print("\n=== –¢–ï–°–¢ 4: –ü–æ–≤–æ—Ä–æ—Ç —Ä–æ–±–æ—Ç–∞ ===")
import math
robot.angle = math.pi / 2  # 90¬∞ - —Å–º–æ—Ç—Ä–∏–º –≤–≤–µ—Ä—Ö

forward_cells_up = robot.get_forward_sector_cells(grid)
print(f"–ü–æ—Å–ª–µ –ø–æ–≤–æ—Ä–æ—Ç–∞ –Ω–∞ 90¬∞: {len(forward_cells_up)} –∫–ª–µ—Ç–æ–∫ –≤ –ø–µ—Ä–µ–¥–Ω–µ–º —Å–µ–∫—Ç–æ—Ä–µ")

obstacles_up = sum(1 for col, row in forward_cells_up if grid.is_cell_filled(col, row))
print(f"–ü—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π –≤–ø–µ—Ä–µ–¥–∏ –ø–æ—Å–ª–µ –ø–æ–≤–æ—Ä–æ—Ç–∞: {obstacles_up}")
print(f"–û–∂–∏–¥–∞–ª–æ—Å—å: 0-1 (–ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è —Å–ø—Ä–∞–≤–∞, –Ω–µ –≤–ø–µ—Ä–µ–¥–∏)")

print("\n‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã!")
```

**–ó–∞–ø—É—Å—Ç–∏—Ç–µ:**

```bash
python test_detection_zones.py
```

---

## üéì –ß—Ç–æ –º—ã —É–∑–Ω–∞–ª–∏?

1. ‚úÖ **–§–æ—Ä–º—É–ª–∞ –ï–≤–∫–ª–∏–¥–æ–≤–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è** ‚Äî `‚àö(dx¬≤ + dy¬≤)`
2. ‚úÖ **–ó–æ–Ω–∞ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è** ‚Äî –∫—Ä—É–≥ —Ä–∞–¥–∏—É—Å–∞ 2√óradius –≤–æ–∫—Ä—É–≥ —Ä–æ–±–æ—Ç–∞
3. ‚úÖ **–£–≥–æ–ª –¥–æ –∫–ª–µ—Ç–∫–∏** ‚Äî `atan2(dy, dx)`
4. ‚úÖ **–†–∞–∑–Ω–∏—Ü–∞ —É–≥–ª–æ–≤** ‚Äî `cell_angle - robot.angle`
5. ‚úÖ **–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —É–≥–ª–∞** ‚Äî –ø—Ä–∏–≤–µ–¥–µ–Ω–∏–µ –≤ –¥–∏–∞–ø–∞–∑–æ–Ω [-œÄ, œÄ]
6. ‚úÖ **–ü–µ—Ä–µ–¥–Ω–∏–π —Å–µ–∫—Ç–æ—Ä** ‚Äî –∫–ª–µ—Ç–∫–∏ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö ¬±45¬∞ –æ—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–æ–±–æ—Ç–∞
7. ‚úÖ **–í–∏–∑—É–∞–ª—å–Ω–∞—è –æ—Ç–ª–∞–¥–∫–∞** ‚Äî –ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–µ —Ü–≤–µ—Ç–Ω—ã–µ –∑–æ–Ω—ã
8. ‚úÖ **–¶–≤–µ—Ç–æ–≤–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è** ‚Äî –∫—Ä–∞—Å–Ω—ã–π = –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–µ –≤–ø–µ—Ä–µ–¥–∏

---

## üí° –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?

```
–ö–∞–∂–¥—ã–π –∫–∞–¥—Ä:

1. robot.get_detection_zone_cells(grid)
   ‚Üí –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ –∫–ª–µ—Ç–∫–∏ –≤ –∫–≤–∞–¥—Ä–∞—Ç–µ –≤–æ–∫—Ä—É–≥ —Ä–æ–±–æ—Ç–∞
   ‚Üí –í—ã—á–∏—Å–ª—è–µ–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–æ –∫–∞–∂–¥–æ–π
   ‚Üí –ï—Å–ª–∏ distance <= 2*radius ‚Üí –¥–æ–±–∞–≤–ª—è–µ–º –≤ set

2. robot.get_forward_sector_cells(grid)
   ‚Üí –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–ª–µ—Ç–∫–∏ –≤ –∑–æ–Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è
   ‚Üí –í—ã—á–∏—Å–ª—è–µ–º —É–≥–æ–ª –¥–æ –∫–∞–∂–¥–æ–π –∫–ª–µ—Ç–∫–∏
   ‚Üí –ï—Å–ª–∏ |—É–≥–æ–ª - robot.angle| <= 45¬∞ ‚Üí –¥–æ–±–∞–≤–ª—è–µ–º –≤ set

3. renderer.draw_detection_zones()
   ‚Üí –†–∏—Å—É–µ–º —Å–∏–Ω–∏–µ –∫–ª–µ—Ç–∫–∏ (–∑–æ–Ω–∞ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è)
   ‚Üí –†–∏—Å—É–µ–º –∂—ë–ª—Ç—ã–µ/–∫—Ä–∞—Å–Ω—ã–µ –∫–ª–µ—Ç–∫–∏ (–ø–µ—Ä–µ–¥–Ω–∏–π —Å–µ–∫—Ç–æ—Ä)
   ‚Üí –ö—Ä–∞—Å–Ω—ã–π —Ü–≤–µ—Ç = –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–µ –≤ –∫–ª–µ—Ç–∫–µ
```

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥

–†–æ–±–æ—Ç "–≤–∏–¥–∏—Ç" –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è! –¢–µ–ø–µ—Ä—å —Å–∞–º–æ–µ –≤—Ä–µ–º—è **–Ω–∞—É—á–∏—Ç—å –µ–≥–æ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å—Å—è** –ø–µ—Ä–µ–¥ –Ω–∏–º–∏.

**–î–∞–ª—å—à–µ:** –î–æ–±–∞–≤–∏–º –ø—Ä–æ–≤–µ—Ä–∫—É —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–π ‚Äî –µ—Å–ª–∏ –≤ –ø–µ—Ä–µ–¥–Ω–µ–º —Å–µ–∫—Ç–æ—Ä–µ –µ—Å—Ç—å –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–µ, –∑–∞–ø—Ä–µ—Ç–∏–º –¥–≤–∏–∂–µ–Ω–∏–µ –≤–ø–µ—Ä—ë–¥!
