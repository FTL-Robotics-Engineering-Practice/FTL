# Задание: Мозг робота (Brain)

## Описание

В этом задании вы реализуете "мозг" робота - систему автоматического управления на основе П-регулятора, которая позволит роботу самостоятельно избегать препятствий.

## Структура задания

Задание разбито на 5 последовательных частей:

### 1. TASK_01_target_angle.md
Определение целевого угла поворота в зависимости от того, с какой стороны находится препятствие.

**Файл:** `brain.py`
**Метод:** `update(robot, sight, grid)` - часть с определением target_angle

### 2. TASK_02_angle_error.md
Вычисление ошибки между текущим углом к препятствию и целевым углом.

**Файл:** `brain.py`
**Метод:** `update(robot, sight, grid)` - часть с вычислением error

### 3. TASK_03_p_controller.md
Реализация П-регулятора для управления угловой скоростью.

**Файл:** `brain.py`
**Метод:** `update(robot, sight, grid)` - часть с вычислением angular_velocity

### 4. TASK_04_random_turn.md
Обработка случая, когда препятствие точно по курсу - случайный выбор направления поворота.

**Файл:** `brain.py`
**Метод:** `update(robot, sight, grid)` - часть с проверкой малого угла

### 5. TASK_05_display_info.md
Вывод целевого угла и ошибки в информационную панель.

**Файл:** `renderer.py`
**Метод:** `draw_info_panel(...)` - добавление отображения ЦЕЛЬ и ОШИБКА

## Порядок выполнения

Выполняйте задания последовательно, начиная с TASK_01. Каждое следующее задание использует результаты предыдущих.

После каждого задания запускайте программу для проверки:

```bash
python code/main.py
```

## Управление

- **TAB** - переключение между режимом карты и режимом робота
- **ЛКМ** - рисовать препятствия (режим карты)
- **ПКМ** - стирать препятствия (режим карты)
- **K** - сохранить карту
- **L** - загрузить карту (в том числе лабиринт)

## Удобная разработка (Watcher)

Чтобы не перезапускать программу вручную каждый раз после внесения изменений в код, используйте скрипт `watcher.py`. Он автоматически перезапустит программу, когда вы закроете окно приложения.

Запуск через вотчер:

```bash
python code/watcher.py
```

Как это работает:
1. Вы запускаете вотчер.
2. Открывается окно программы.
3. Вы пишете код, сохраняете файл.
4. Нажимаете **ESC** в окне программы (или закрываете крестиком).
5. Вотчер тут же запускает программу заново с вашими изменениями.

## Как работает П-регулятор

П-регулятор (пропорциональный) - это простой алгоритм управления:
- **Вход:** ошибка (разница между желаемым и текущим значением)
- **Выход:** управляющее воздействие = ошибка × коэффициент
- **Свойство:** чем больше ошибка, тем сильнее реакция

В нашем случае:
- **Ошибка:** разница между углом к препятствию и целевым углом (90°)
- **Управление:** угловая скорость поворота робота
- **Результат:** робот поворачивает, чтобы препятствие оказалось сбоку (под углом 90°)

## Стратегия избегания препятствий

1. Робот видит препятствие через систему sight
2. Вычисляет угол к центру масс препятствий
3. Определяет, с какой стороны препятствие (слева или справа)
4. Устанавливает цель: повернуть на 90° в эту сторону
5. П-регулятор плавно поворачивает робота к цели
6. Робот движется вперед, огибая препятствие

## Результат

После выполнения всех заданий у вас будет:
- Робот автоматически избегает препятствия
- Панель показывает угол до препятствий, целевой угол и ошибку
- Робот может проходить лабиринты!

## Тестирование

1. Нарисуйте простые препятствия - робот должен их огибать
2. Загрузите лабиринт (L) и запустите робота (TAB)
3. Понаблюдайте, как робот проходит лабиринт

Если робот "застревает" или крутится на месте - попробуйте изменить коэффициент `kp` в классе Brain.
