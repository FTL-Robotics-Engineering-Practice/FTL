# Задание 3: П-регулятор

## Описание

Нужно реализовать пропорциональный (П) регулятор, который будет управлять угловой скоростью робота на основе ошибки.

## Что такое П-регулятор?

**П-регулятор** (Proportional controller) - это простейший алгоритм автоматического управления:

```
Управление = Ошибка × Коэффициент
```

### Свойства П-регулятора:

1. **Пропорциональность**: чем больше ошибка, тем сильнее реакция
2. **Автоматическое затухание**: по мере приближения к цели ошибка уменьшается, реакция слабеет
3. **Плавность**: нет резких скачков управления

## Как это работает для робота?

Вам нужно вычислить `angular_velocity` (угловую скорость) по формуле:

$$ \omega = e \cdot K_p $$

Где:
- $ \omega $ (`angular_velocity`) - угловая скорость, которую нужно установить роботу
- $ e $ (`error`) - ошибка угла (в радианах), вычисленная в предыдущем задании
- $ K_p $ (`self.kp`) - коэффициент пропорциональности (по умолчанию 0.5)

### Примеры работы:

**Пример 1: Большая ошибка**
- error = -30° = -0.52 рад (нужно сильно повернуть налево)
- kp = 0.5
- angular_velocity = -0.52 × 0.5 = -0.26 рад/с
- Робот быстро поворачивает налево

**Пример 2: Малая ошибка**
- error = -5° = -0.09 рад (почти достигли цели)
- kp = 0.5
- angular_velocity = -0.09 × 0.5 = -0.045 рад/с
- Робот медленно доворачивается

**Пример 3: Ошибка нулевая**
- error = 0° (цель достигнута)
- kp = 0.5
- angular_velocity = 0 × 0.5 = 0
- Робот не поворачивается

## Ограничение максимальной скорости

После вычисления угловой скорости нужно обязательно ограничить её диапазоном `[-max_angular_velocity, +max_angular_velocity]`.

Это нужно, чтобы:
- Робот не вращался слишком быстро при больших ошибках
- Движение было более стабильным и предсказуемым

Используйте функции `min()` и `max()` или условные операторы для ограничения значения.

## Установка скоростей робота

После вычисления угловой скорости нужно установить её роботу вместе с линейной скоростью:

```python
safe_velocity = robot.check_collision(grid, self.linear_velocity)
robot.set_velocities(linear=safe_velocity, angular=angular_velocity)
```

Где:
- `safe_velocity` - линейная скорость с учётом проверки коллизий
- `angular_velocity` - вычисленная вами угловая скорость

## Место вставки кода

Найдите в файле `brain.py` метод `update()` и место с комментарием:

```python
# TODO: П-регулятор
# angular_velocity = ...
# Ограничить максимумом
# Установить скорости робота
```

## Проверка

После реализации:
1. Запустите программу: `python code/main.py`
2. Нарисуйте несколько препятствий
3. Переключитесь в режим робота (TAB)
4. Робот должен начать автоматически поворачиваться, чтобы обходить препятствия!

## Интерпретация поведения

- Робот видит препятствие и начинает поворачивать в сторону
- По мере поворота ошибка уменьшается
- Когда препятствие оказывается примерно сбоку (90°), робот стабилизируется
- Робот движется вперед, огибая препятствие

## Настройка параметров

Если робот ведёт себя странно:

- **Слишком медленно поворачивает**: увеличьте `kp` в конструкторе Brain
- **Крутится слишком резко**: уменьшите `kp` или `max_angular_velocity`
- **Не может пройти узкие места**: уменьшите `linear_velocity`

## Ограничения П-регулятора

П-регулятор имеет одну проблему: **когда препятствие точно по курсу** (angle_diff ≈ 0), робот "не знает", в какую сторону поворачивать (влево или вправо одинаково хорошо).

Это мы исправим в следующем задании!
